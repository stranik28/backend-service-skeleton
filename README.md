# Сервис  предоставляет REST API для управления балансами пользователей и транзакциями между ними.

## Запуск

``` cmd
docker-compose up 
```

## Для запуска тестов

``` cmd
pytest tests/
```

##  Дополинтельные требования
<ul> 
  <li> При проектировки сервиса учтено, чтобы он работал под k8s </li>
  <li> Архитектура гарантирует обработку транзакции ровно 1 раз </li>
  <ol> 
    <li> Транзакционность базы данных и блокировки на уровне приложения для обеспечения уникальности обработки транзакции. </li>
    
``` python
async with db.transaction():
   ...
``` 

  <li> Метод Идемпотентность (Каждая транзакция имеет свой UID unique) </li>
  </ol> 
  


  <li> Для уведомления других сервисов о транзакциях можно использовать брокеры сообщений (например, RabbitMQ, Kafka), </li>
  <li> Для контроля качества работы сервиса можно использовать различные инструменты и подходы, такие как юнит-тестирование (например, с помощью pytest),
  функциональное тестирование, интеграционное тестирование, тестирование производительности, code review, CI/CD </li>
  <li> Для гарантии неотрицательности баланса пользователя используется следующие приемы </li>
  
  <ol>
    <li> Проверка на уровне кода </li>
    
``` python
if txn_type == 'WITHDRAW':
  balance = await get_user_balance(user_id)
if balance < amount:
  raise ValueError('Not enough money to withdraw')
```
    
<li> Провекра на уровне базы данных </li>
    
``` python
@validates('balance')
def validate_balance(self, value):
  if value < 0:
    raise ValueError("Balance can't be negative.")
  return value
````
  </ol>
</ul>

###
